{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/todo-commands.schema.json",
  "title": "Todo Command",
  "type": "object",
  "additionalProperties": false,
  "oneOf": [
    { "$ref": "#/$defs/add_todo" },
    { "$ref": "#/$defs/add_multiple_todos" },
    { "$ref": "#/$defs/complete_todo" },
    { "$ref": "#/$defs/uncomplete_todo" },
    { "$ref": "#/$defs/create_list" },
    { "$ref": "#/$defs/switch_list" },
    { "$ref": "#/$defs/delete_todo" },
    { "$ref": "#/$defs/list_todos" },
    { "$ref": "#/$defs/edit_todo" },
    { "$ref": "#/$defs/command_sequence" }
  ],

  "$defs": {
    "isoDate": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "YYYY-MM-DD"
    },
    "priority": {
      "type": "string",
      "enum": ["high", "medium", "low"]
    },
    "categories": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "minItems": 1,
      "uniqueItems": true
    },

    "add_todo": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "title"],
      "properties": {
        "action": { "const": "add_todo" },
        "title": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "priority": { "$ref": "#/$defs/priority" },
        "dueDate": { "$ref": "#/$defs/isoDate" },
        "categories": { "$ref": "#/$defs/categories" }
      }
    },

    "add_multiple_todos": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "items"],
      "properties": {
        "action": { "const": "add_multiple_todos" },
        "items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["title"],
            "properties": {
              "title": { "type": "string", "minLength": 1 },
              "description": { "type": "string" },
              "priority": { "$ref": "#/$defs/priority" },
              "dueDate": { "$ref": "#/$defs/isoDate" },
              "categories": { "$ref": "#/$defs/categories" }
            }
          }
        }
      }
    },

    "complete_todo": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "todoNumber"],
      "properties": {
        "action": { "const": "complete_todo" },
        "todoNumber": { "type": "integer", "minimum": 1 }
      }
    },

    "uncomplete_todo": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "todoNumber"],
      "properties": {
        "action": { "const": "uncomplete_todo" },
        "todoNumber": { "type": "integer", "minimum": 1 }
      }
    },

    "create_list": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "name"],
      "properties": {
        "action": { "const": "create_list" },
        "name": { "type": "string", "minLength": 1 }
      }
    },

    "switch_list": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "name"],
      "properties": {
        "action": { "const": "switch_list" },
        "name": { "type": "string", "minLength": 1 }
      }
    },

    "delete_todo": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "todoNumber"],
      "properties": {
        "action": { "const": "delete_todo" },
        "todoNumber": { "type": "integer", "minimum": 1 }
      }
    },

    "list_todos": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action"],
      "properties": {
        "action": { "const": "list_todos" },
        "filter": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "status": { "type": "string", "enum": ["all", "completed", "incomplete"] },
            "priority": { "$ref": "#/$defs/priority" },
            "category": { "type": "string", "minLength": 1 },
            "dueOn": { "$ref": "#/$defs/isoDate" },
            "dueBefore": { "$ref": "#/$defs/isoDate" },
            "dueAfter": { "$ref": "#/$defs/isoDate" },
            "query": { "type": "string" }
          }
        }
      }
    },

    "edit_todo": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "todoNumber"],
      "properties": {
        "action": { "const": "edit_todo" },
        "todoNumber": { "type": "integer", "minimum": 1 },
        "title": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "priority": { "$ref": "#/$defs/priority" },
        "dueDate": { "$ref": "#/$defs/isoDate" },
        "categories": { "$ref": "#/$defs/categories" }
      },
      "anyOf": [
        { "required": ["title"] },
        { "required": ["description"] },
        { "required": ["priority"] },
        { "required": ["dueDate"] },
        { "required": ["categories"] }
      ]
    },

    "command_sequence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action", "commands"],
      "properties": {
        "action": { "const": "command_sequence" },
        "description": { "type": "string" },
        "commands": {
          "type": "array",
          "minItems": 1,
          "maxItems": 10,
          "items": {
            "oneOf": [
              { "$ref": "#/$defs/add_todo" },
              { "$ref": "#/$defs/add_multiple_todos" },
              { "$ref": "#/$defs/complete_todo" },
              { "$ref": "#/$defs/uncomplete_todo" },
              { "$ref": "#/$defs/create_list" },
              { "$ref": "#/$defs/switch_list" },
              { "$ref": "#/$defs/delete_todo" },
              { "$ref": "#/$defs/list_todos" },
              { "$ref": "#/$defs/edit_todo" }
            ]
          }
        }
      }
    }
  },

  "examples": [
    { "action": "add_todo", "title": "buy milk", "priority": "high", "dueDate": "2025-08-15" },
    { "action": "complete_todo", "todoNumber": 2 },
    { "action": "edit_todo", "todoNumber": 4, "priority": "high" },
    {
      "action": "command_sequence",
      "description": "Create list, switch, add high-priority task",
      "commands": [
        { "action": "create_list", "name": "work" },
        { "action": "switch_list", "name": "work" },
        { "action": "add_todo", "title": "prep slides", "priority": "high", "dueDate": "2025-07-31" }
      ]
    }
  ]
}